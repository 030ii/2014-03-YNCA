<html>
	<head>
		<title>Black and White game</title>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="./gameui.css" />
	</head>
	<body>
		<div id ="beforeStart">
			<button id="startButton">Start</button>
		</div>
		<div id= "wrapper">
			<div class="window">
				<div class="bar">STATUS</div>
				<div id="opponent">
					<div class="showColor">
						<!-- 8개 칸의 테이블만들 -->
						<table>
						<tr>
							<td>1r</td>
							<td>2r</td>
							<td>3r</td>
							<td>4r</td>
						</tr>
						<tr>
							<td>5r</td>
							<td>6r</td>
							<td>7r</td>
							<td>8r</td>
						</tr>
						</table>
					</div>
					<div class="showScore">
						<table>
							<tr>
							<td>Someone</td>
							<td>2</td>
							</tr>
						</table>
					</div>
				</div>

				<div id="round"> Round
					<br> 1 </br>
				</div>

				<div id= "me">
					<div class="showColor">
						<!-- 8개 칸의 테이블만들 -->
						<table>
						<tr>
							<td>1r</td>
							<td>2r</td>
							<td>3r</td>
							<td>4r</td>
						</tr>
						<tr>
							<td>5r</td>
							<td>6r</td>
							<td>7r</td>
							<td>8r</td>
						</tr>
					</table>
					</div>
					<div class="showScore">
						<!-- 2칸 테이블 위: 이름
						아래: 점수 -->
						<table id="table">
							<tr>
							<td>Otherone</td>
							<td>3</td>
							</tr>
						</table>
					</div>
				</div>
			</div>

			<div class="window">
				<div class="bar">INPUT</div>
				<div id="opponentInfo">
					<div id="opponentGauge">
						<!-- 5칸짜리 테이블 
							각 칸에 점수 -->
							<table>
								<tr><td>80-99</td></tr>
								<tr><td>60-79</td></tr>
								<tr><td>40-59</td></tr>
								<tr><td>20-39</td></tr>
								<tr><td>0-19</td></tr>
							</table>
					</div>
					<div id="opponentColor">black</div>
				</div>
				<div id="input">
					<div id="turn"> 선공 </div>
					<div id="time"> 120초 </div>
					<div id="gaugeBar">
						<div id="remainingPt">
							
							<span>60</span>
							<!-- 2개 칼럼 테이 -->
						</div>
					</div>
					<div id="inputBar">
						<input id="inputBox" type="text">
						<button id="getInput">submit</button>
					</div>
				</div>
			</div>
		</div>
	</body>
	<footer>Yeslie</footer>
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		var socket = io();

		document.getElementById('startButton').addEventListener('click', function(){
			document.getElementById('beforeStart').style.display = "none";
			document.getElementById('wrapper').style.display="block";
			socket.emit('joinRoom');

		});
		socket.on('joinedRoom', function(msg){
        	console.log(msg);
      	});

      	socket.on('gameStatus', function(msg){
        	console.log(msg);
      	});

		socket.on('gameStart', function(num){

			var round = 1;
			var turn = 1;
			var firstPlayer;
			firstPlayer=player1;

			var player1 = {
				name: "최초 시작 사람",
				numOfToken:99,
				inputNum:0,
				point:0,
				color:"black",
				gauge:5,
				setColor : function(){
					if(player1.inputNum < 10){
						this.color="black";
					}
					else
						this.color="white";
				},

				setGauge : function(){
					
					if(player1.numOfToken>79){
						this.gauge=5;
						return;
					}
					else if(player1.numOfToken>59){
						this.gauge=4;
						return;
					}
					else if(player1.numOfToken>39){
						this.gauge=3;
						return;
					}
					else if(player1.numOfToken>19){
						this.gauge=2;
						return;
					}
					else{
						this.gauge=1;
						return;
					}
				},

				showCandG : function(){
						console.log(this.color);
						console.log(this.gauge);
				}
			}

			var player2 ={
				name: "최초 시작 때 두번째로 한 사람",
				numOfToken:99,
				inputNum:0,
				point:0,
				color:"black",
				gauge:5,
				setColor : function(){
					if(player2.inputNum < 10){
						this.color="black";
					}
					else
						this.color="white";
				},

				setGauge : function(){
					
					if(player2.numOfToken>79){
						this.gauge=5;
						return;
					}
					else if(player2.numOfToken>59){
						this.gauge=4;
						return;
					}
					else if(player2.numOfToken>39){
						this.gauge=3;
						return;
					}
					else if(player2.numOfToken>19){
						this.gauge=2;
						return;
					}
					else{
						this.gauge=1;
						return;
					}
				},

				showCandG : function(){
						console.log(this.color);
						console.log(this.gauge);
				}
			}

			player1.otherPlayer =player2;
			player2.otherPlayer = player1;

				document.getElementById('getInput').addEventListener('click',function(){
					var input = document.getElementById('inputBox');

				switch(turn){
					case 1:
					firstPlayer.inputNum= parseInt(input.value);
					input.value ="";
					//checkInput
					if(firstPlayer.inputNum > firstPlayer.numOfToken){
						console.log("Invalid input. Please try again");
						break;
					}
					firstPlayer.numOfToken = firstPlayer.numOfToken - firstPlayer.inputNum;
					console.log("left amount: "+ firstPlayer.numOfToken);   
					after();
					break;

					case 2:
					// var input = document.getElementById('input');
					firstPlayer.otherPlayer.inputNum= parseInt(input.value);
					input.value ="";
					//checkInput
					if(firstPlayer.otherPlayer.inputNum > firstPlayer.otherPlayer.numOfToken){
						console.log("Invalid input. Please try again");
						break;
					}
					firstPlayer.otherPlayer.numOfToken = firstPlayer.otherPlayer.numOfToken - firstPlayer.otherPlayer.inputNum;
					console.log("left amount: "+ firstPlayer.otherPlayer.numOfToken);  
					firstPlayer.otherPlayer.setColor();
					firstPlayer.otherPlayer.setGauge();
					firstPlayer.otherPlayer.showCandG();

					if(firstPlayer.inputNum > firstPlayer.otherPlayer.inputNum){
						console.log("winner is first player");
						firstPlayer.point++;
					}
					else if (firstPlayer.inputNum == firstPlayer.otherPlayer.inputNum){
						console.log("It's a tie!");
					}
					else{
						console.log("winner is second player");
						firstPlayer= firstPlayer.otherPlayer;
						firstPlayer.point++;
					}
					
					round++;
					
					if(round>10){
						console.log("end of game");
						if(player1.score> player2.score){
							console.log("player1 is winnner");
						}
						else 
							console.log("player2 is winner");
						break;
					}
					before();
					break;
				}
			// };
			});

			//선공하기 전까지의 준비
			var before= function(){
			console.log("This round: " + round);
			console.log("Current score" + player1.point + " : " + player2.point);
			turn =1;
			console.log("선공은 " +firstPlayer.name);
			console.log("First player input your number");

			};

			//후공하기 전까지의 준비
			var after = function(){
				firstPlayer.setColor();
				firstPlayer.setGauge();
				firstPlayer.showCandG();
				turn=2;
				console.log("후공");
				console.log("Second player, input your number");
			};

			if(num==1){
				console.log("you will start first");
				// this = firstPlayer;
				//얘로 들어온 애가 firstPlayer이다.
				before();
			}
			else{
				console.log("you will start second");
			}

		});
	</script>
</html>